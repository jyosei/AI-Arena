version: "3.9"
volumes:
  db_data:

services:
  db:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: '123456'
      MYSQL_DATABASE: aiarena
    ports: ["3306:3306"]
    volumes:
      - db_data:/var/lib/mysql

  backend:
    build: ./backend
    # ä¸å†éœ€è¦å¯¹å¤–æš´éœ²ç«¯å£ï¼Œå› ä¸ºå®ƒåªå’Œ frontend é€šä¿¡
    #ports: ["8000:8000"] 
    depends_on: [db]
    volumes: ["./backend:/app"]
    environment:
      DB_NAME: 'aiarena'
      DB_USER: 'root'
      DB_PASSWORD: '123456'
      DB_HOST: 'db'
      DB_PORT: '3306'
      # åœ¨è¿™é‡Œæ·»åŠ æ‚¨çš„ API Key
      OPENAI_API_KEY: 'sk-ser2cEa4NSlALdseJwob4oube3Trg0NOLwvXEH7yUAeYy9k9' 
    command: sh -c "chmod +x ./wait-for-db.sh && ./wait-for-db.sh db 'python manage.py migrate && python manage.py runserver 0.0.0.0:8000'"

  frontend: # <-- ğŸŒŸ ç¡®ä¿è¿™é‡Œæœ‰æ­£ç¡®çš„ç¼©è¿›ï¼Œä½¿å…¶æˆä¸º services çš„å­é¡¹
    build: ./frontend
    ports: ["8000:80"]  # ä¸»æœº 5173 æ˜ å°„åˆ°å®¹å™¨å†… Nginx ç›‘å¬çš„ 80 ç«¯å£ (å·²ä¿®æ­£)
    volumes: ["./frontend:/app"]