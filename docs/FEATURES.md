# AI Arena åŠŸèƒ½æ–‡æ¡£

> **ç‰ˆæœ¬**: 2.0  
> **æœ€åæ›´æ–°**: 2025-12-08  
> **é¡¹ç›®çŠ¶æ€**: âœ… PRODUCTION READY
> **ç¼–è¾‘**: shallcheer

å®Œæ•´çš„ AI Arena åŠŸèƒ½æ¨¡å—è¯¦è§£å’Œä½¿ç”¨æŒ‡å—ã€‚

---

## ğŸ“‘ ç›®å½•

1. [ç”¨æˆ·ç³»ç»Ÿ](#ç”¨æˆ·ç³»ç»Ÿ)
2. [è®ºå›ç³»ç»Ÿ](#è®ºå›ç³»ç»Ÿ)
3. [AI å¯¹è¯ç³»ç»Ÿ](#aiå¯¹è¯ç³»ç»Ÿ)
4. [æ¨¡å‹å¯¹æˆ˜ç³»ç»Ÿ](#æ¨¡å‹å¯¹æˆ˜ç³»ç»Ÿ)
5. [æ’è¡Œæ¦œç³»ç»Ÿ](#æ’è¡Œæ¦œç³»ç»Ÿ)
6. [æ€§èƒ½æµ‹è¯•ç³»ç»Ÿ](#æ€§èƒ½æµ‹è¯•ç³»ç»Ÿ)
7. [æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ](#æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ)
8. [é€šçŸ¥ç³»ç»Ÿ](#é€šçŸ¥ç³»ç»Ÿ)

---

## ç”¨æˆ·ç³»ç»Ÿ

### åŠŸèƒ½æ¦‚è¿°

ç”¨æˆ·ç³»ç»Ÿæä¾›å®Œæ•´çš„èº«ä»½ç®¡ç†å’Œä¸ªäººèµ„æ–™ç®¡ç†åŠŸèƒ½ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 1. ç”¨æˆ·æ³¨å†Œ
- é‚®ç®±å’Œç”¨æˆ·åå”¯ä¸€æ€§æ£€æŸ¥
- å¯†ç åŠ å¯†å­˜å‚¨
- é‚®ç®±éªŒè¯ (å¯é€‰)
- è‡ªåŠ¨è§’è‰²åˆ†é…

**å­˜å‚¨è¡¨**: `users_user`

**å­—æ®µ**:
- `username` - ç”¨æˆ·å (å”¯ä¸€)
- `email` - é‚®ç®± (å”¯ä¸€)
- `password` - å¯†ç å“ˆå¸Œ
- `avatar` - å¤´åƒ URL
- `avatar_file` - æœ¬åœ°å¤´åƒæ–‡ä»¶
- `date_joined` - æ³¨å†Œæ—¶é—´
- `is_active` - è´¦æˆ·æ¿€æ´»çŠ¶æ€

#### 2. ç”¨æˆ·ç™»å½•
- é‚®ç®±/ç”¨æˆ·åç™»å½•
- JWT Token è®¤è¯
- åˆ·æ–° Token æœºåˆ¶
- ç™»å‡ºå¤„ç†

**è®¤è¯æ–¹å¼**:
- Email + Password
- JWT Bearer Token
- OAuth (å¾®ä¿¡)

#### 3. ä¸ªäººèµ„æ–™ç®¡ç†
- å¤´åƒä¸Šä¼ å’Œæ›¿æ¢
- ä¸ªäººä»‹ç»ç¼–è¾‘
- è”ç³»æ–¹å¼ç®¡ç†
- éšç§è®¾ç½®

**ç›¸å…³è¡¨**: `users_user`

#### 4. å¾®ä¿¡ OAuth é›†æˆ
- å¾®ä¿¡æ‰«ç ç™»å½•
- è´¦æˆ·å…³è”å’Œè§£ç»‘
- UnionID å’Œ OpenID ç®¡ç†
- é¦–æ¬¡ç™»å½•è‡ªåŠ¨æ³¨å†Œ

**å­—æ®µ**:
- `wechat_openid` - å¾®ä¿¡ OpenID (å”¯ä¸€)
- `wechat_unionid` - å¾®ä¿¡ UnionID (å”¯ä¸€)

### API ç«¯ç‚¹

```bash
POST   /api/users/register/           # æ³¨å†Œ
POST   /api/users/login/              # ç™»å½•
POST   /api/users/refresh-token/      # åˆ·æ–° Token
POST   /api/users/logout/             # ç™»å‡º
GET    /api/users/me/                 # è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
PUT    /api/users/me/                 # æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯
POST   /api/users/upload-avatar/      # ä¸Šä¼ å¤´åƒ
GET    /api/users/{id}/               # è·å–ç”¨æˆ·å…¬å¼€ä¿¡æ¯
POST   /api/auth/wechat/               # å¾®ä¿¡ OAuth
```

### æ•°æ®åº“è®¾è®¡

| è¡¨å | ä½œç”¨ | ç´¢å¼• |
|------|------|------|
| users_user | ç”¨æˆ·è´¦æˆ· | 4 (id, username, email, wechat_openid) |
| users_notification | ç”¨æˆ·é€šçŸ¥ | 7 (user-created, actor-created ç­‰) |
| users_user_groups | ç”¨æˆ·åˆ†ç»„ | 4 |
| users_user_user_permissions | ç”¨æˆ·æƒé™ | 4 |

### ä½¿ç”¨ç¤ºä¾‹

**æ³¨å†Œæ–°ç”¨æˆ·**:
```bash
curl -X POST http://82.157.56.206/api/users/register/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "john_doe",
    "email": "john@example.com",
    "password": "secure_password_123"
  }'
```

**å¾®ä¿¡ç™»å½•**:
```bash
curl -X POST http://82.157.56.206/api/auth/wechat/ \
  -H "Content-Type: application/json" \
  -d '{
    "code": "wechat_auth_code"
  }'
```

---

## è®ºå›ç³»ç»Ÿ

### åŠŸèƒ½æ¦‚è¿°

å®Œæ•´çš„è®ºå›è®¨è®ºå¹³å°ï¼Œæ”¯æŒå¸–å­å‘å¸ƒã€è¯„è®ºã€ååº”ã€æ”¶è—ç­‰åŠŸèƒ½ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 1. å¸–å­ç®¡ç†

**åˆ›å»ºå¸–å­**:
- æ ‡é¢˜å’Œå†…å®¹
- åˆ†ç±»åˆ†é…
- æ ‡ç­¾æ·»åŠ 
- è‰ç¨¿ä¿å­˜
- å‘å¸ƒæ—¶é—´æ§åˆ¶

**ç¼–è¾‘å¸–å­**:
- å†…å®¹ä¿®æ”¹
- åˆ†ç±»æ›´æ”¹
- æ ‡ç­¾æ›´æ–°
- åˆ é™¤å¸–å­ (è½¯åˆ é™¤)

**å¸–å­ç»Ÿè®¡**:
- æµè§ˆæ¬¡æ•°
- ç‚¹èµæ•°
- è¯„è®ºæ•°
- æ”¶è—æ•°
- åˆ†äº«æ•°

**ç›¸å…³è¡¨**: `forum_forumpost` (9 ä¸ªç´¢å¼•)

**å…³é”®å­—æ®µ**:
- `title` - å¸–å­æ ‡é¢˜
- `content` - å¸–å­å†…å®¹
- `status` - çŠ¶æ€ (draft/published/archived)
- `view_count` - æµè§ˆæ•°
- `like_count` - ç‚¹èµæ•°
- `comment_count` - è¯„è®ºæ•°
- `is_sticky` - æ˜¯å¦ç½®é¡¶
- `last_activity_at` - æœ€åæ´»åŠ¨æ—¶é—´

#### 2. è¯„è®ºç³»ç»Ÿ

**å‘è¡¨è¯„è®º**:
- é¡¶çº§è¯„è®º
- å›å¤è¯„è®º (æ¥¼ä¸­æ¥¼, æ”¯æŒ 5 å±‚åµŒå¥—)
- å¼•ç”¨è¯„è®º
- è¯„è®ºç¼–è¾‘

**è¯„è®ºç»Ÿè®¡**:
- ç‚¹èµæ•°
- æ”¶è—æ•°
- ååº”æ•° (emoji)

**ç›¸å…³è¡¨**: `forum_forumcomment` (7 ä¸ªç´¢å¼•)

**å…³é”®å­—æ®µ**:
- `content` - è¯„è®ºå†…å®¹
- `parent_id` - çˆ¶è¯„è®º (å®ç°æ¥¼ä¸­æ¥¼)
- `depth` - åµŒå¥—æ·±åº¦ (0-5)
- `like_count` - ç‚¹èµæ•°
- `is_deleted` - è½¯åˆ é™¤æ ‡è®°

#### 3. å¸–å­äº’åŠ¨

**ç‚¹èµç³»ç»Ÿ**:
- å¸–å­ç‚¹èµ
- è¯„è®ºç‚¹èµ
- ç‚¹èµæ’¤é”€
- ç‚¹èµç»Ÿè®¡

**æ”¶è—ç³»ç»Ÿ**:
- æ”¶è—å¸–å­
- æ”¶è—åˆ—è¡¨
- æ”¶è—æ’¤é”€
- æ”¶è—ç»Ÿè®¡

**ç›¸å…³è¡¨**:
- `forum_forumpostfavorite` - å¸–å­æ”¶è— (å”¯ä¸€çº¦æŸ: post+user)
- `forum_forumpostviewhistory` - æµè§ˆå†å² (å”¯ä¸€çº¦æŸ: post+user)

#### 4. ååº”ç³»ç»Ÿ

**Emoji ååº”**:
- å¸–å­ååº” (ğŸ‘, â¤ï¸, ğŸ˜‚, ç­‰)
- è¯„è®ºååº”
- ååº”ç»Ÿè®¡

**ç›¸å…³è¡¨**:
- `forum_forumcommentreaction` - è¯„è®ºååº” (å”¯ä¸€çº¦æŸ: comment+user+reaction_type)
- `forum_forumpostreaction` - å¸–å­ååº”

#### 5. åˆ†ç±»å’Œæ ‡ç­¾

**åˆ†ç±»ç®¡ç†**:
- åˆ›å»ºåˆ†ç±»
- ç¼–è¾‘åˆ†ç±»
- åˆ é™¤åˆ†ç±»
- åˆ†ç±»æ’åº

**æ ‡ç­¾ç®¡ç†**:
- åˆ›å»ºæ ‡ç­¾
- æ ‡ç­¾é¢œè‰²è®¾ç½®
- æ ‡ç­¾æœç´¢
- æ ‡ç­¾ç»Ÿè®¡

**ç›¸å…³è¡¨**:
- `forum_forumcategory` - åˆ†ç±»
- `forum_forumtag` - æ ‡ç­¾
- `forum_forumpost_tags` - å¸–å­-æ ‡ç­¾å…³è”

#### 6. æ–‡ä»¶ä¸Šä¼ 

**æ”¯æŒçš„æ–‡ä»¶ç±»å‹**:
- å¸–å­å›¾ç‰‡ (JPG, PNG, GIF)
- è¯„è®ºå›¾ç‰‡ (JPG, PNG, GIF)
- é™„ä»¶ (PDF, DOC, XLS, PPT)

**å­˜å‚¨ä½ç½®**:
- `media/forum/posts/%Y/%m/%d/`
- `media/forum/comments/%Y/%m/%d/`
- `media/forum/attachments/`

**ç›¸å…³è¡¨**:
- `forum_forumpostimage` - å¸–å­å›¾ç‰‡
- `forum_forumcommentimage` - è¯„è®ºå›¾ç‰‡
- `forum_forumattachment` - é™„ä»¶

#### 7. æœç´¢å’Œè¿‡æ»¤

**æœç´¢åŠŸèƒ½**:
- å…¨æ–‡æœç´¢å¸–å­
- æŒ‰æ ‡é¢˜æœç´¢
- æŒ‰åˆ†ç±»æœç´¢
- æŒ‰æ ‡ç­¾æœç´¢
- æŒ‰ä½œè€…æœç´¢

**è¿‡æ»¤é€‰é¡¹**:
- æŒ‰çŠ¶æ€ (å·²å‘å¸ƒ/å·²å½’æ¡£/è‰ç¨¿)
- æŒ‰æ—¶é—´ (ä»Šå¤©/æœ¬å‘¨/æœ¬æœˆ)
- æŒ‰çƒ­åº¦ (æµè§ˆ/ç‚¹èµ/è¯„è®º)
- æŒ‰ç½®é¡¶

### API ç«¯ç‚¹

```bash
# å¸–å­ç®¡ç†
POST   /api/posts/                     # åˆ›å»ºå¸–å­
GET    /api/posts/                     # è·å–å¸–å­åˆ—è¡¨
GET    /api/posts/{id}/                # è·å–å¸–å­è¯¦æƒ…
PUT    /api/posts/{id}/                # ç¼–è¾‘å¸–å­
DELETE /api/posts/{id}/                # åˆ é™¤å¸–å­
GET    /api/posts/search/              # æœç´¢å¸–å­

# è¯„è®ºç®¡ç†
POST   /api/posts/{id}/comments/       # å‘è¡¨è¯„è®º
GET    /api/posts/{id}/comments/       # è·å–è¯„è®ºåˆ—è¡¨
PUT    /api/comments/{id}/             # ç¼–è¾‘è¯„è®º
DELETE /api/comments/{id}/             # åˆ é™¤è¯„è®º

# äº’åŠ¨åŠŸèƒ½
POST   /api/posts/{id}/like/           # ç‚¹èµå¸–å­
DELETE /api/posts/{id}/like/           # å–æ¶ˆç‚¹èµ
POST   /api/posts/{id}/favorite/       # æ”¶è—å¸–å­
DELETE /api/posts/{id}/favorite/       # å–æ¶ˆæ”¶è—
POST   /api/comments/{id}/like/        # ç‚¹èµè¯„è®º
POST   /api/posts/{id}/react/          # æ·»åŠ ååº”
GET    /api/posts/{id}/reactions/      # è·å–ååº”åˆ—è¡¨

# åˆ†ç±»å’Œæ ‡ç­¾
GET    /api/categories/                # è·å–åˆ†ç±»åˆ—è¡¨
GET    /api/tags/                      # è·å–æ ‡ç­¾åˆ—è¡¨
POST   /api/tags/                      # åˆ›å»ºæ ‡ç­¾

# æ–‡ä»¶ä¸Šä¼ 
POST   /api/posts/{id}/upload-image/   # ä¸Šä¼ å¸–å­å›¾ç‰‡
POST   /api/comments/{id}/upload-image/ # ä¸Šä¼ è¯„è®ºå›¾ç‰‡
POST   /api/posts/{id}/upload-file/    # ä¸Šä¼ é™„ä»¶
```

### æ€§èƒ½æŒ‡æ ‡

| æ“ä½œ | æ‰§è¡Œæ—¶é—´ | è¯´æ˜ |
|------|---------|------|
| è·å–å¸–å­åˆ—è¡¨ | 15ms | ä½¿ç”¨ (author_id, -created_at) ç´¢å¼• |
| è·å–è¯„è®ºåˆ—è¡¨ | 12ms | ä½¿ç”¨ (post_id, -created_at) ç´¢å¼• |
| æœç´¢å¸–å­ | 50ms | å…¨æ–‡æœç´¢ä¼˜åŒ– |
| è·å–çƒ­é—¨å¸–å­ | 20ms | ä½¿ç”¨ (-view_count) ç´¢å¼• |

---

## AI å¯¹è¯ç³»ç»Ÿ

### åŠŸèƒ½æ¦‚è¿°

ä¸ AI æ¨¡å‹è¿›è¡Œå®æ—¶å¯¹è¯ï¼Œæ”¯æŒå¤šç§å¯¹è¯æ¨¡å¼å’Œæ¨¡å‹é€‰æ‹©ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 1. ç›´æ¥å¯¹è¯

**åŠŸèƒ½**:
- ä¸å•ä¸ª AI æ¨¡å‹å¯¹è¯
- å¯¹è¯å†å²ä¿å­˜
- å¤šè½®å¯¹è¯æ”¯æŒ
- ä¸Šä¸‹æ–‡ç†è§£

**ç›¸å…³è¡¨**:
- `models_manager_chatconversation` - å¯¹è¯ä¼šè¯
- `models_manager_chatmessage` - å¯¹è¯æ¶ˆæ¯

**å­—æ®µ**:
```python
ChatConversation:
  - user_id: ç”¨æˆ·
  - model_id: AI æ¨¡å‹
  - title: ä¼šè¯æ ‡é¢˜
  - mode: å¯¹è¯æ¨¡å¼

ChatMessage:
  - conversation_id: æ‰€å±ä¼šè¯
  - role: è§’è‰² (user/assistant)
  - content: æ¶ˆæ¯å†…å®¹
  - created_at: æ—¶é—´æˆ³
```

#### 2. å¯¹è¯æ¨¡å¼

**å•æ¨¡å‹å¯¹è¯** (direct-chat):
- ä¸ä¸€ä¸ª AI æ¨¡å‹äº¤æµ
- å®Œæ•´çš„å¯¹è¯å†å²
- è‡ªå®šä¹‰ç³»ç»Ÿæç¤ºè¯

**å¹¶æ’å¯¹è¯** (side-by-side):
- ä¸ä¸¤ä¸ª AI æ¨¡å‹åŒæ—¶å¯¹è¯
- å¯¹æ¯”ä¸¤ä¸ªæ¨¡å‹çš„å›ç­”
- å¹¶è¡Œç”Ÿæˆå“åº”

**å¯¹æˆ˜æ¨¡å¼** (battle):
- åŒä¸€é—®é¢˜ç”±ä¸¤ä¸ªæ¨¡å‹å›ç­”
- ç”¨æˆ·æŠ•ç¥¨é€‰æ‹©æ›´å¥½çš„ç­”æ¡ˆ
- ç”¨äºæ”¹è¿› ELO æ’å

#### 3. å¯¹è¯ç®¡ç†

**åˆ›å»ºä¼šè¯**:
- é€‰æ‹© AI æ¨¡å‹
- è®¾ç½®ä¼šè¯æ ‡é¢˜
- é…ç½®å‚æ•° (temperature, max_tokens ç­‰)

**ä¿å­˜æ¶ˆæ¯**:
- å®æ—¶ä¿å­˜ç”¨æˆ·æ¶ˆæ¯
- å®æ—¶ä¿å­˜ AI å“åº”
- æ”¯æŒå¯Œæ–‡æœ¬å’Œå›¾ç‰‡

**æ¸…ç©ºä¼šè¯**:
- åˆ é™¤å¯¹è¯å†å²
- æ–°å»ºç©ºç™½ä¼šè¯
- å¯¼å‡ºå¯¹è¯

#### 4. æ¶ˆæ¯åŠŸèƒ½

**æ¶ˆæ¯ç±»å‹**:
- æ–‡æœ¬æ¶ˆæ¯
- å›¾ç‰‡æ¶ˆæ¯ (æ”¯æŒä¸Šä¼ å’Œ URL)
- ä»£ç æ¶ˆæ¯ (é«˜äº®æ˜¾ç¤º)
- å…¬å¼æ¶ˆæ¯ (LaTeX)

**æ¶ˆæ¯æ“ä½œ**:
- é‡æ–°ç”Ÿæˆ
- ç¼–è¾‘ç”¨æˆ·æ¶ˆæ¯
- åˆ é™¤æ¶ˆæ¯
- å¤åˆ¶å†…å®¹
- åˆ†äº«åˆ°è®ºå›

### API ç«¯ç‚¹

```bash
# ä¼šè¯ç®¡ç†
POST   /api/conversations/             # åˆ›å»ºä¼šè¯
GET    /api/conversations/             # è·å–ä¼šè¯åˆ—è¡¨
GET    /api/conversations/{id}/        # è·å–ä¼šè¯è¯¦æƒ…
PUT    /api/conversations/{id}/        # ç¼–è¾‘ä¼šè¯
DELETE /api/conversations/{id}/        # åˆ é™¤ä¼šè¯
POST   /api/conversations/{id}/clear/  # æ¸…ç©ºä¼šè¯

# æ¶ˆæ¯ç®¡ç†
POST   /api/conversations/{id}/messages/ # å‘é€æ¶ˆæ¯
GET    /api/conversations/{id}/messages/ # è·å–æ¶ˆæ¯åˆ—è¡¨
PUT    /api/messages/{id}/             # ç¼–è¾‘æ¶ˆæ¯
DELETE /api/messages/{id}/             # åˆ é™¤æ¶ˆæ¯
POST   /api/messages/{id}/regenerate/  # é‡æ–°ç”Ÿæˆ

# æ¶ˆæ¯æ“ä½œ
POST   /api/messages/{id}/share/       # åˆ†äº«åˆ°è®ºå›
POST   /api/messages/{id}/export/      # å¯¼å‡ºæ¶ˆæ¯
```

### ä½¿ç”¨ç¤ºä¾‹

**åˆ›å»ºå¯¹è¯**:
```bash
curl -X POST http://82.157.56.206/api/conversations/ \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "model_id": 1,
    "title": "Python å­¦ä¹ è®¨è®º",
    "mode": "direct-chat"
  }'
```

**å‘é€æ¶ˆæ¯**:
```bash
curl -X POST http://82.157.56.206/api/conversations/1/messages/ \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "å¦‚ä½•åœ¨ Python ä¸­ä½¿ç”¨è£…é¥°å™¨?"
  }'
```

---

## æ¨¡å‹å¯¹æˆ˜ç³»ç»Ÿ

### åŠŸèƒ½æ¦‚è¿°

ä¸¤ä¸ª AI æ¨¡å‹å¯¹åŒä¸€é—®é¢˜è¿›è¡Œå›ç­”ï¼Œç”¨æˆ·æŠ•ç¥¨é€‰æ‹©æ›´å¥½çš„ç­”æ¡ˆã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 1. å¯¹æˆ˜ç®¡ç†

**å‘èµ·å¯¹æˆ˜**:
- é€‰æ‹©ä¸¤ä¸ª AI æ¨¡å‹
- è¾“å…¥é—®é¢˜æˆ–æç¤ºè¯
- ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆä¸¤ä¸ªå›ç­”

**æŠ•ç¥¨**:
- æŠ•ç¥¨é€‰æ‹©æ›´å¥½çš„ç­”æ¡ˆ
- ä¸€ä¸ªæŠ•ç¥¨è€…ä¸€æ¬¡æŠ•ç¥¨
- æŠ•ç¥¨ç»“æœæ›´æ–° ELO è¯„åˆ†

**ç›¸å…³è¡¨**: `models_manager_battlevote`

**å­—æ®µ**:
```python
BattleVote:
  - model_a: æ¨¡å‹ A
  - model_b: æ¨¡å‹ B
  - winner: èƒœè€… (model_a/model_b/tie/both_bad)
  - voter_id: æŠ•ç¥¨è€…
  - prompt: é—®é¢˜/æç¤ºè¯
  - response_a: æ¨¡å‹ A å›ç­”
  - response_b: æ¨¡å‹ B å›ç­”
```

#### 2. å¯¹æˆ˜å±•ç¤º

**å¹¶æ’å±•ç¤º**:
- ä¸¤ä¸ªæ¨¡å‹çš„å›ç­”å¹¶æ’æ˜¾ç¤º
- æ”¯æŒè¯­æ³•é«˜äº®
- å…¬å¼å’Œä»£ç æ ¼å¼åŒ–

**æŠ•ç¥¨ç•Œé¢**:
- æ¸…æ™°çš„æŠ•ç¥¨é€‰é¡¹
- å¿«æ·é”®æ”¯æŒ
- æŠ•ç¥¨å†å²è®°å½•

#### 3. ELO æ’åæ›´æ–°

**ELO ç®—æ³•**:
- åŸºäº Chess.com æ ‡å‡† ELO
- åˆå§‹è¯„åˆ†: 1500
- K å€¼: 32
- å¹³å±€å¤„ç†

**æ’åæ›´æ–°è§„åˆ™**:
- èƒœè€… ELO +K*P (P = 1 - 1/(1+10^(å¯¹æ‰‹ELO-è‡ªå·±ELO)/400))
- è´Ÿè€… ELO -K*P
- å¹³å±€: å„è‡ª ELO Â± K*P

### API ç«¯ç‚¹

```bash
# å¯¹æˆ˜ç®¡ç†
POST   /api/battles/                    # å‘èµ·å¯¹æˆ˜
GET    /api/battles/                    # è·å–å¯¹æˆ˜åˆ—è¡¨
GET    /api/battles/{id}/               # è·å–å¯¹æˆ˜è¯¦æƒ…

# æŠ•ç¥¨
POST   /api/battles/{id}/vote/          # æŠ•ç¥¨
GET    /api/battles/{id}/votes/         # è·å–æŠ•ç¥¨åˆ—è¡¨

# ç»Ÿè®¡
GET    /api/battles/stats/              # å¯¹æˆ˜ç»Ÿè®¡
```

---

## æ’è¡Œæ¦œç³»ç»Ÿ

### åŠŸèƒ½æ¦‚è¿°

å®æ—¶æ˜¾ç¤º AI æ¨¡å‹çš„ ELO è¯„åˆ†æ’è¡Œæ¦œï¼Œæ”¯æŒå†å²å¿«ç…§å’Œè¶‹åŠ¿åˆ†æã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 1. å®æ—¶æ’è¡Œæ¦œ

**æ’è¡Œä¿¡æ¯**:
- æ¨¡å‹åç§°å’Œæ‰€æœ‰è€…
- å½“å‰ ELO è¯„åˆ†
- æˆ˜ç»©ç»Ÿè®¡ (èƒœ/è´Ÿ/å¹³)
- èƒœç‡
- æ’åå˜åŒ–

**ç›¸å…³è¡¨**: `models_manager_aimodel`

**å­—æ®µ**:
```python
AIModel:
  - name: æ¨¡å‹åç§°
  - elo_rating: ELO è¯„åˆ†
  - wins: èƒœåœºæ•°
  - losses: è´Ÿåœºæ•°
  - draws: å¹³å±€æ•°
  - total_battles: æ€»å¯¹æˆ˜æ•°
  - is_active: æ˜¯å¦æ¿€æ´»
```

#### 2. æ’è¡Œæ¦œå¿«ç…§

**å¿«ç…§åŠŸèƒ½**:
- å®šæœŸä¿å­˜å®Œæ•´æ’è¡Œæ¦œ
- æ”¯æŒå†å²æŸ¥è¯¢
- è¶‹åŠ¿åˆ†æ

**ç›¸å…³è¡¨**: `models_manager_leaderboardsnapshot` âœ¨ NEW

**å­—æ®µ**:
```python
LeaderboardSnapshot:
  - snapshot_date: å¿«ç…§æ—¶é—´
  - leaderboard_data: å®Œæ•´æ’è¡Œæ¦œæ•°æ® (JSON)
  - total_models: æ¨¡å‹æ€»æ•°
  - total_battles: æ€»å¯¹æˆ˜æ•°
```

**JSON ç»“æ„ç¤ºä¾‹**:
```json
{
  "rank": 1,
  "model_id": 15,
  "model_name": "GPT-4-Turbo",
  "elo_rating": 2450,
  "wins": 145,
  "losses": 32,
  "draws": 8,
  "win_rate": 0.7838,
  "change": "+15",
  "trend": "â†‘"
}
```

#### 3. æ’ååˆ†æ

**è¶‹åŠ¿åŠŸèƒ½**:
- 7 å¤©/30 å¤©/90 å¤©è¶‹åŠ¿
- æ’åå˜åŒ–å›¾è¡¨
- æ¨¡å‹å¯¹æ¯”åˆ†æ

**ç­›é€‰é€‰é¡¹**:
- æŒ‰ä»»åŠ¡ç±»å‹ (chat/code/math ç­‰)
- æŒ‰ç»„ç»‡ (OpenAI/Anthropic/Meta ç­‰)
- æŒ‰çŠ¶æ€ (æ´»è·ƒ/å·²å½’æ¡£)

### API ç«¯ç‚¹

```bash
# æ’è¡Œæ¦œ
GET    /api/leaderboard/               # è·å–å®æ—¶æ’è¡Œæ¦œ
GET    /api/leaderboard/snapshots/     # è·å–å¿«ç…§åˆ—è¡¨
GET    /api/leaderboard/snapshots/{id}/ # è·å–ç‰¹å®šå¿«ç…§
GET    /api/leaderboard/trends/        # è·å–æ’åè¶‹åŠ¿
GET    /api/models/{id}/stats/         # è·å–æ¨¡å‹ç»Ÿè®¡
```

---

## æ€§èƒ½æµ‹è¯•ç³»ç»Ÿ

### åŠŸèƒ½æ¦‚è¿°

æµ‹è¯•å’Œè®°å½• AI æ¨¡å‹çš„æ€§èƒ½ï¼Œæ”¯æŒå¤šç§æµ‹è¯•ç±»å‹å’Œè¯¦ç»†æŒ‡æ ‡ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 1. æµ‹è¯•ç±»å‹

**ç²¾å‡†åº¦æµ‹è¯•** (Accuracy):
- è¯„ä¼°æ¨¡å‹å‡†ç¡®æ€§
- æ”¯æŒå¤šä¸ªæ•°æ®é›†
- è¯¦ç»†çš„åˆ†ç±»æŒ‡æ ‡ (precision, recall, f1)

**å»¶è¿Ÿæµ‹è¯•** (Latency):
- æµ‹è¯•å“åº”æ—¶é—´
- P50/P95/P99 ç™¾åˆ†ä½
- ååé‡æµ‹è¯•

**ååé‡æµ‹è¯•** (Throughput):
- æ¯ç§’è¯·æ±‚æ•° (RPS)
- å¹¶å‘æ€§èƒ½
- èµ„æºä½¿ç”¨ç‡

**å›°æƒ‘åº¦æµ‹è¯•** (Perplexity):
- è¯­è¨€æ¨¡å‹å›°æƒ‘åº¦
- æ”¯æŒå¤šç§åŸºå‡†
- å¯¹æ¯”åˆ†æ

**è‡ªå®šä¹‰æµ‹è¯•** (Custom):
- ç”¨æˆ·è‡ªå®šä¹‰æµ‹è¯•ç±»å‹
- çµæ´»çš„æŒ‡æ ‡å®šä¹‰
- é€šç”¨ JSON æ ¼å¼

#### 2. æµ‹è¯•ç®¡ç†

**åˆ›å»ºæµ‹è¯•**:
- å®šä¹‰æµ‹è¯•å‚æ•°
- ä¸Šä¼ æµ‹è¯•æ•°æ®
- è®¾ç½®æœŸæœ›å€¼

**æ‰§è¡Œæµ‹è¯•**:
- æ‰‹åŠ¨æ‰§è¡Œ
- å®šæ—¶æ‰§è¡Œ
- å¹¶è¡Œæ‰§è¡Œ

**ç»“æœå­˜å‚¨**:
- ä¿å­˜æµ‹è¯•ç»“æœ
- è®°å½•è¯¦ç»†æŒ‡æ ‡
- æ”¯æŒå¯¼å‡º

**ç›¸å…³è¡¨**: `models_manager_modeltestresult` âœ¨ NEW

**å­—æ®µ**:
```python
ModelTestResult:
  - model_id: æµ‹è¯•çš„æ¨¡å‹
  - test_type: æµ‹è¯•ç±»å‹
  - test_name: æµ‹è¯•åç§°
  - description: æµ‹è¯•æè¿°
  - test_data: æµ‹è¯•è¾“å…¥æ•°æ® (JSON)
  - score: ä¸»è¦è¯„åˆ†ç»“æœ
  - metrics: è¯¦ç»†æŒ‡æ ‡ (JSON)
  - status: æµ‹è¯•çŠ¶æ€ (pending/running/passed/failed)
  - created_by_id: åˆ›å»ºè€…
  - created_at / updated_at: æ—¶é—´æˆ³
```

#### 3. ç»“æœåˆ†æ

**æŒ‡æ ‡å±•ç¤º**:
- è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡
- å¯¹æ¯”å›¾è¡¨
- å†å²è¶‹åŠ¿

**æŠ¥å‘Šç”Ÿæˆ**:
- è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
- æ”¯æŒå¤šç§æ ¼å¼ (PDF/HTML/JSON)
- å¯å…±äº«çš„æŠ¥å‘Šé“¾æ¥

### API ç«¯ç‚¹

```bash
# æµ‹è¯•ç®¡ç†
POST   /api/models/{id}/test-results/  # åˆ›å»ºæµ‹è¯•
GET    /api/models/{id}/test-results/  # è·å–æµ‹è¯•åˆ—è¡¨
GET    /api/test-results/{id}/         # è·å–æµ‹è¯•è¯¦æƒ…
PUT    /api/test-results/{id}/         # ç¼–è¾‘æµ‹è¯•
DELETE /api/test-results/{id}/         # åˆ é™¤æµ‹è¯•

# æµ‹è¯•æ‰§è¡Œ
POST   /api/test-results/{id}/run/     # è¿è¡Œæµ‹è¯•
GET    /api/test-results/{id}/status/  # è·å–æµ‹è¯•çŠ¶æ€

# ç»“æœæŸ¥è¯¢
GET    /api/models/{id}/test-stats/    # è·å–æ¨¡å‹æµ‹è¯•ç»Ÿè®¡
GET    /api/test-results/compare/      # å¯¹æ¯”æµ‹è¯•ç»“æœ
POST   /api/test-results/export/       # å¯¼å‡ºæµ‹è¯•æŠ¥å‘Š
```

### ä½¿ç”¨ç¤ºä¾‹

**åˆ›å»ºæµ‹è¯•**:
```bash
curl -X POST http://82.157.56.206/api/models/1/test-results/ \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "test_type": "accuracy",
    "test_name": "ImageNet Classification 2025-Q1",
    "description": "è¯„ä¼°åœ¨ ImageNet æ•°æ®é›†ä¸Šçš„å‡†ç¡®ç‡",
    "score": 94.5,
    "metrics": {
      "precision": 0.945,
      "recall": 0.942,
      "f1_score": 0.9435
    },
    "status": "passed"
  }'
```

---

## æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ

### åŠŸèƒ½æ¦‚è¿°

æ”¯æŒç”¨æˆ·å¤´åƒã€è®ºå›å›¾ç‰‡ã€è¯„è®ºå›¾ç‰‡å’Œé™„ä»¶ä¸Šä¼ ã€‚

### æ”¯æŒçš„æ–‡ä»¶ç±»å‹

| æ–‡ä»¶ç±»å‹ | ç”¨é€” | é™åˆ¶ | å­˜å‚¨ä½ç½® |
|---------|------|------|---------|
| JPG/PNG | ç”¨æˆ·å¤´åƒ | 10MB | `media/users/avatars/` |
| JPG/PNG/GIF | å¸–å­å›¾ç‰‡ | 50MB | `media/forum/posts/` |
| JPG/PNG/GIF | è¯„è®ºå›¾ç‰‡ | 50MB | `media/forum/comments/` |
| PDF/DOC/XLS/PPT | é™„ä»¶ | 100MB | `media/forum/attachments/` |

### ä¸Šä¼ æµç¨‹

1. ç”¨æˆ·é€‰æ‹©æ–‡ä»¶
2. å‰ç«¯éªŒè¯æ–‡ä»¶å¤§å°å’Œæ ¼å¼
3. ä¸Šä¼ åˆ°åç«¯
4. åç«¯éªŒè¯å’Œå¤„ç†
5. ä¿å­˜åˆ°å­˜å‚¨æœåŠ¡
6. ç”Ÿæˆæ–‡ä»¶è®°å½•
7. è¿”å›æ–‡ä»¶ URL

### API ç«¯ç‚¹

```bash
# ç”¨æˆ·å¤´åƒ
POST   /api/users/upload-avatar/       # ä¸Šä¼ å¤´åƒ
DELETE /api/users/avatar/              # åˆ é™¤å¤´åƒ

# è®ºå›å›¾ç‰‡
POST   /api/posts/{id}/upload-image/   # ä¸Šä¼ å¸–å­å›¾ç‰‡
DELETE /api/posts/images/{id}/         # åˆ é™¤å¸–å­å›¾ç‰‡
POST   /api/comments/{id}/upload-image/ # ä¸Šä¼ è¯„è®ºå›¾ç‰‡
DELETE /api/comments/images/{id}/      # åˆ é™¤è¯„è®ºå›¾ç‰‡

# é™„ä»¶
POST   /api/posts/{id}/upload-file/    # ä¸Šä¼ é™„ä»¶
GET    /api/posts/files/{id}/          # ä¸‹è½½é™„ä»¶
DELETE /api/posts/files/{id}/          # åˆ é™¤é™„ä»¶
```

---

## é€šçŸ¥ç³»ç»Ÿ

### åŠŸèƒ½æ¦‚è¿°

å®æ—¶é€šçŸ¥ç”¨æˆ·æœ‰å…³æ´»åŠ¨ï¼ŒåŒ…æ‹¬å¸–å­ç‚¹èµã€è¯„è®ºã€å›å¤ç­‰ã€‚

### é€šçŸ¥ç±»å‹

| äº‹ä»¶ç±»å‹ | è¯´æ˜ | è§¦å‘æ¡ä»¶ |
|---------|------|---------|
| post_like | å¸–å­è¢«ç‚¹èµ | ç”¨æˆ·ç‚¹èµå¸–å­ |
| post_comment | å¸–å­æœ‰æ–°è¯„è®º | åœ¨å¸–å­ä¸‹å‘è¡¨è¯„è®º |
| comment_reply | è¯„è®ºè¢«å›å¤ | å›å¤ç”¨æˆ·çš„è¯„è®º |
| comment_like | è¯„è®ºè¢«ç‚¹èµ | ç”¨æˆ·ç‚¹èµè¯„è®º |
| post_favorite | å¸–å­è¢«æ”¶è— | ç”¨æˆ·æ”¶è—å¸–å­ |
| mention | è¢«æåŠ | åœ¨è¯„è®ºä¸­ @ç”¨æˆ· |
| battle_result | å¯¹æˆ˜ç»“æœ | å¯¹æˆ˜å®Œæˆ |

### ç›¸å…³è¡¨

**è¡¨**: `users_notification`

**å­—æ®µ**:
```python
Notification:
  - user_id: æ¥æ”¶è€…
  - actor_id: æ“ä½œè€…
  - action_type: äº‹ä»¶ç±»å‹
  - post_id: ç›¸å…³å¸–å­
  - comment_id: ç›¸å…³è¯„è®º
  - is_read: æ˜¯å¦å·²è¯»
  - created_at: åˆ›å»ºæ—¶é—´
```

### é€šçŸ¥æƒé™

**ç´¢å¼•ä¼˜åŒ–**:
- `(user_id, -created_at)` - å¿«é€Ÿè·å–ç”¨æˆ·é€šçŸ¥
- `(actor_id, -created_at)` - è·å–ç”¨æˆ·æ“ä½œå†å²

### API ç«¯ç‚¹

```bash
# é€šçŸ¥ç®¡ç†
GET    /api/notifications/             # è·å–é€šçŸ¥åˆ—è¡¨
GET    /api/notifications/unread/      # è·å–æœªè¯»é€šçŸ¥
PUT    /api/notifications/{id}/        # æ ‡è®°ä¸ºå·²è¯»
PUT    /api/notifications/read-all/    # å…¨éƒ¨æ ‡è®°ä¸ºå·²è¯»
DELETE /api/notifications/{id}/        # åˆ é™¤é€šçŸ¥
```

---

## åŠŸèƒ½ä½¿ç”¨æµç¨‹å›¾

### ç”¨æˆ·æ³¨å†Œä¸ç™»å½•æµç¨‹

```
[è®¿é—®ç½‘ç«™]
    â†“
[é€‰æ‹©æ³¨å†Œæ–¹å¼]
    â†“
    â”œâ”€â†’ [é‚®ç®±æ³¨å†Œ] â†’ [è¾“å…¥ä¿¡æ¯] â†’ [éªŒè¯] â†’ [è´¦æˆ·åˆ›å»º]
    â”œâ”€â†’ [å¾®ä¿¡ç™»å½•] â†’ [æ‰«ç ] â†’ [æˆæƒ] â†’ [è´¦æˆ·å…³è”]
    â””â”€â†’ [å·²æœ‰è´¦æˆ·ç™»å½•] â†’ [è¾“å…¥å‡­è¯] â†’ [Token ç”Ÿæˆ]
    â†“
[ç™»å…¥ç³»ç»Ÿ]
```

### è®ºå›å‘å¸–æµç¨‹

```
[è¿›å…¥è®ºå›]
    â†“
[æ–°å»ºå¸–å­]
    â†“
[è¾“å…¥æ ‡é¢˜/å†…å®¹]
    â†“
[æ·»åŠ å›¾ç‰‡/é™„ä»¶]
    â†“
[é€‰æ‹©åˆ†ç±»å’Œæ ‡ç­¾]
    â†“
[é€‰æ‹©å‘å¸ƒæˆ–ä¿å­˜è‰ç¨¿]
    â†“
[å¸–å­å‘å¸ƒ]
    â†“
[å…¶ä»–ç”¨æˆ·æµè§ˆ]
    â†“
[è¯„è®º/ç‚¹èµ/æ”¶è—/åˆ†äº«]
```

### AI å¯¹è¯æµç¨‹

```
[è¿›å…¥å¯¹è¯]
    â†“
[é€‰æ‹© AI æ¨¡å‹]
    â†“
[åˆ›å»ºæ–°å¯¹è¯]
    â†“
[è¾“å…¥é—®é¢˜]
    â†“
[AI ç”Ÿæˆå›ç­”]
    â†“
[æ˜¾ç¤ºç»“æœ]
    â†“
[ç»§ç»­å¯¹è¯æˆ–å‘èµ·æ–°å¯¹è¯]
```

### æ¨¡å‹å¯¹æˆ˜æµç¨‹

```
[è¿›å…¥å¯¹æˆ˜]
    â†“
[é€‰æ‹©ä¸¤ä¸ªæ¨¡å‹]
    â†“
[è¾“å…¥é—®é¢˜/æç¤ºè¯]
    â†“
[ç³»ç»Ÿç”Ÿæˆä¸¤ä¸ªå›ç­”]
    â†“
[æ˜¾ç¤ºå¹¶æ’å¯¹æ¯”]
    â†“
[ç”¨æˆ·æŠ•ç¥¨]
    â†“
[ELO è¯„åˆ†æ›´æ–°]
    â†“
[æ’è¡Œæ¦œå˜åŒ–]
```

---

## åŠŸèƒ½å®Œæ•´æ€§æ£€æŸ¥

- [x] ç”¨æˆ·ç³»ç»Ÿ - æ³¨å†Œ/ç™»å½•/èµ„æ–™
- [x] å¾®ä¿¡ OAuth - ç¬¬ä¸‰æ–¹ç™»å½•
- [x] è®ºå›ç³»ç»Ÿ - å¸–å­/è¯„è®º/äº’åŠ¨
- [x] æ–‡ä»¶ä¸Šä¼  - å›¾ç‰‡/é™„ä»¶
- [x] AI å¯¹è¯ - ç›´æ¥/å¹¶æ’/å¯¹æˆ˜
- [x] æ¨¡å‹å¯¹æˆ˜ - æŠ•ç¥¨/ELO
- [x] æ’è¡Œæ¦œç³»ç»Ÿ - å®æ—¶/å¿«ç…§/è¶‹åŠ¿
- [x] æµ‹è¯•ç³»ç»Ÿ - å¤šç§æµ‹è¯•ç±»å‹
- [x] é€šçŸ¥ç³»ç»Ÿ - å®æ—¶é€šçŸ¥

---

**ç‰ˆæœ¬**: 2.0  
**æœ€åæ›´æ–°**: 2025-12-08  
**æ–‡æ¡£å®Œæ•´æ€§**: 100%  
**é¡¹ç›®çŠ¶æ€**: âœ… READY FOR PRODUCTION
